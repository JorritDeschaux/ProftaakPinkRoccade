
@{
    ViewBag.Title = "Index";
}

@section header {
    <!-- leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>

    <!-- Proj4 and Proj4Leaflet -->
    <script src="https://unpkg.com/proj4@2.5.0/dist/proj4-src.js"></script>
    <script src="https://unpkg.com/proj4leaflet@1.0.1"></script>
}

<h2>Maak een melding</h2>
<div class="row">
    <div class="col-3">
        <form action="">
            <div class="form-group">
                <label for="location">location</label>
                <input class="form-control" type="text" name="location" id="location" readonly>
            </div>
            <div class="form-group">
                <label for="description">description</label>
                <textarea class="form-control" name="description" id="description" cols="30" rows="10"></textarea>
            </div>
            <div class="form-group">
                <label for="img">input</label>
                <input class="form-control-file" type="file" name="img" id="img">
            </div>
            <input id="lat" type="hidden" name="lang">
            <input id="long" type="hidden" name="long">
        </form>
    </div>
    <div class="col-9">
        <div id="mapid" style="height: 64rem"></div>
    </div>
</div>

@section scripts {
    @*TODO: Move javascript*@
    <script>
        let map = L.map('mapid', {
            continuousWorld: true,
            crs: new L.Proj.CRS('EPSG:28992', '+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +towgs84=565.2369,50.0087,465.658,-0.406857330322398,0.350732676542563,-1.8703473836068,4.0812 +no_defs', { // eslint-disable-line no-undef
                transformation: L.Transformation(-1, -1, 0, 0), // eslint-disable-line no-undef
                resolutions: [3440.640, 1720.320, 860.160, 430.080, 215.040, 107.520, 53.760, 26.880, 13.440, 6.720, 3.360, 1.680, 0.840, 0.420, 0.210, 0.105],
                origin: [-285401.920, 903401.920],
                bounds: L.bounds([-285401.920, 903401.920], [595401.920, 22598.080]) // eslint-disable-line no-undef
            }),
            center: [52.176997, 5.200000],
            @* center: [51.441642, 5.4697225], *@
            zoom: 1
        });
        L.tileLayer('https://geodata.nationaalgeoregister.nl/tiles/service/wmts/brtachtergrondkaart/EPSG:28992/{z}/{x}/{y}.png', {
            minZoom: 3,
            maxZoom: 15,
            zoomOffset: 0,
            tileSize: 256,
            WMTS: false,
            attribution: 'Kaartgegevens &copy; <a href="https://www.kadaster.nl">Kadaster</a>',
        }).addTo(map);
        map.on('click', (ev) => {
            let latlng = map.mouseEventToLatLng(ev.originalEvent);
            @* console.log(latlng.lat + ', ' + latlng.lng); *@
            fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latlng.lat}&lon=${latlng.lng}&format=json`)
                .then((response) => response.json())
                .then(data => {
                    $('#location').val(data.display_name)
                    $('#lat').val(latlng.lat)
                    $('#lng').val(latlng.lng)
                    @* console.log(data); alert(data.display_name) *@
                })
                .catch((error) => console.log(error))
        })
    </script>
}
